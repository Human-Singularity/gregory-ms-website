"use strict";var MAX_TEXT_DIVS_TO_RENDER=1e5,NonWhitespaceRegexp=/\S/;function isAllWhitespace(t){return!NonWhitespaceRegexp.test(t)}var TextLayerBuilder=function(){function t(t){this.textLayerDiv=t.textLayerDiv,this.renderingDone=!1,this.divContentDone=!1,this.pageIdx=t.pageIndex,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=t.viewport,this.textDivs=[],this.findController=t.findController||null}return t.prototype={_finishRendering:function(){this.renderingDone=!0;var t=document.createEvent("CustomEvent");t.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:this.pageNumber}),this.textLayerDiv.dispatchEvent(t)},renderLayer:function(){var t=document.createDocumentFragment(),e=this.textDivs,n=e.length,i=document.createElement("canvas").getContext("2d");if(n>MAX_TEXT_DIVS_TO_RENDER){this._finishRendering();return}for(var r=0;r<n;r++){var s,a,d,o=e[r];if(void 0===o.dataset.isWhitespace){var h=o.style.fontSize,l=o.style.fontFamily;(h!==s||l!==a)&&(i.font=h+" "+l,s=h,a=l);var f=i.measureText(o.textContent).width;if(f>0){t.appendChild(o),d=void 0!==o.dataset.canvasWidth?"scaleX("+o.dataset.canvasWidth/f+")":"";var v=o.dataset.angle;v&&(d="rotate("+v+"deg) "+d),d&&CustomStyle.setProp("transform",o,d)}}}this.textLayerDiv.appendChild(t),this._finishRendering(),this.updateMatches()},render:function(t){if(this.divContentDone&&!this.renderingDone){if(this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),t){var e=this;this.renderTimer=setTimeout(function(){e.renderLayer(),e.renderTimer=null},t)}else this.renderLayer()}},appendText:function(t,e){var n,i,r=e[t.fontName],s=document.createElement("div");if(this.textDivs.push(s),isAllWhitespace(t.str)){s.dataset.isWhitespace=!0;return}var a=PDFJS.Util.transform(this.viewport.transform,t.transform),d=Math.atan2(a[1],a[0]);r.vertical&&(d+=Math.PI/2);var o=Math.sqrt(a[2]*a[2]+a[3]*a[3]),h=o;r.ascent?h=r.ascent*h:r.descent&&(h=(1+r.descent)*h),0===d?(n=a[4],i=a[5]-h):(n=a[4]+h*Math.sin(d),i=a[5]-h*Math.cos(d)),s.style.left=n+"px",s.style.top=i+"px",s.style.fontSize=o+"px",s.style.fontFamily=r.fontFamily,s.textContent=t.str,PDFJS.pdfBug&&(s.dataset.fontName=t.fontName),0!==d&&(s.dataset.angle=d*(180/Math.PI)),s.textContent.length>1&&(r.vertical?s.dataset.canvasWidth=t.height*this.viewport.scale:s.dataset.canvasWidth=t.width*this.viewport.scale)},setTextContent:function(t){this.textContent=t;for(var e=t.items,n=0,i=e.length;n<i;n++)this.appendText(e[n],t.styles);this.divContentDone=!0},convertMatches:function(t){for(var e=0,n=0,i=this.textContent.items,r=i.length-1,s=null===this.findController?0:this.findController.state.query.length,a=[],d=0,o=t.length;d<o;d++){for(var h=t[d];e!==r&&h>=n+i[e].str.length;)n+=i[e].str.length,e++;e===i.length&&console.error("Could not find a matching mapping");var l={begin:{divIdx:e,offset:h-n}};for(h+=s;e!==r&&h>n+i[e].str.length;)n+=i[e].str.length,e++;l.end={divIdx:e,offset:h-n},a.push(l)}return a},renderMatches:function(t){if(0!==t.length){var e=this.textContent.items,n=this.textDivs,i=null,r=this.pageIdx,s=null!==this.findController&&r===this.findController.selected.pageIdx,a=null===this.findController?-1:this.findController.selected.matchIdx,d=null!==this.findController&&this.findController.state.highlightAll,o={divIdx:-1,offset:void 0},h=a,l=h+1;if(d)h=0,l=t.length;else if(!s)return;for(var f=h;f<l;f++){var v=t[f],c=v.begin,u=v.end,x=s&&f===a?" selected":"";if(this.findController&&this.findController.updateMatchPosition(r,f,n,c.divIdx,u.divIdx),i&&c.divIdx===i.divIdx?C(i.divIdx,i.offset,c.offset):(null!==i&&C(i.divIdx,i.offset,o.offset),m(c)),c.divIdx===u.divIdx)C(c.divIdx,c.offset,u.offset,"highlight"+x);else{C(c.divIdx,c.offset,o.offset,"highlight begin"+x);for(var g=c.divIdx+1,p=u.divIdx;g<p;g++)n[g].className="highlight middle"+x;m(u,"highlight end"+x)}i=u}i&&C(i.divIdx,i.offset,o.offset)}function m(t,e){var i=t.divIdx;n[i].textContent="",C(i,0,t.offset,e)}function C(t,i,r,s){var a=n[t],d=e[t].str.substring(i,r),o=document.createTextNode(d);if(s){var h=document.createElement("span");h.className=s,h.appendChild(o),a.appendChild(h);return}a.appendChild(o)}},updateMatches:function(){if(this.renderingDone){for(var t=this.matches,e=this.textDivs,n=this.textContent.items,i=-1,r=0,s=t.length;r<s;r++){for(var a=t[r],d=Math.max(i,a.begin.divIdx),o=d,h=a.end.divIdx;o<=h;o++){var l=e[o];l.textContent=n[o].str,l.className=""}i=a.end.divIdx+1}null!==this.findController&&this.findController.active&&(this.matches=this.convertMatches(null===this.findController?[]:this.findController.pageMatches[this.pageIdx]||[]),this.renderMatches(this.matches))}}},t}();function DefaultTextLayerFactory(){}DefaultTextLayerFactory.prototype={createTextLayerBuilder:function(t,e,n){return new TextLayerBuilder({textLayerDiv:t,pageIndex:e,viewport:n})}};